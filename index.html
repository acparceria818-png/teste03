<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="Portal de Transporte da AC Parceria e Terraplenagem">
  <meta name="theme-color" content="#b00000" />
  <title>AC Parceria - Portal de Transporte</title>
  
  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="logo.jpg" type="image/jpg">
  
  <!-- CSS externo -->
  <link rel="stylesheet" href="styles.css">
  
  <!-- JS externo -->
  <script type="module" src="firebase.js"></script>
  <script type="module" src="app.js"></script>
</head>
<body>

<header>
  <img src="Logo.jpg" alt="AC Logo" class="logo" loading="lazy" />
  <h1>AC PARCERIA E TERRAPLENAGEM â€” Portal de Transporte</h1>
  <div class="user-status" id="userStatus" style="display:none">
    <span id="userName"></span>
    <button class="logout-btn" onclick="logout()" title="Sair">ğŸšª</button>
  </div>
</header>

<div class="top-actions container">
  <div>
    <button class="icon-btn" id="installBtn" style="display:none" aria-label="Instalar aplicativo">
      ğŸ“¥ Instalar
    </button>
  </div>
  <div>
    <button class="icon-btn" id="darkToggle" title="Alternar tema" aria-label="Alternar tema claro/escuro">
      ğŸŒ™
    </button>
    <span class="connection-status" id="connectionStatus">â—</span>
  </div>
</div>

<main class="container">

  <!-- TELA DE BOAS VINDAS -->
  <section id="welcome" class="tela ativa" aria-labelledby="welcomeTitle">
    <img src="avatar.png" class="avatar" alt="Avatar AC" loading="lazy" />
    <div>
      <h2 id="welcomeTitle">Bem-vindo ao Portal de Transporte</h2>
      <p>Rotas, registro de entrada/saÃ­da e avisos oficiais da <strong>AC Parceria e Terraplenagem</strong>.</p>
      <p class="card" style="margin-top:12px">
        â±ï¸ <strong>Importante:</strong> O formulÃ¡rio de controle de veÃ­culo deve ser preenchido <strong>2Ã— ao dia</strong> â€” ao iniciar a jornada (entrada) e ao finalizar (saÃ­da).
      </p>
      <button class="btn" onclick="entrarNoPortal()" id="entrarBtn">
        Entrar no Portal
      </button>
    </div>
  </section>

  <!-- TELA: ESCOLHA DE PERFIL -->
  <section id="telaEscolhaPerfil" class="tela hidden">
    <h2>Como vocÃª estÃ¡ acessando?</h2>

    <div class="card" onclick="selecionarPerfil('motorista')" tabindex="0" role="button" 
         onkeydown="if(event.key === 'Enter' || event.key === ' ') selecionarPerfil('motorista')">
      <h3>ğŸš› Motorista</h3>
      <p>Acesso para conduÃ§Ã£o e compartilhamento de rota</p>
    </div>

    <div class="card" onclick="selecionarPerfil('passageiro')" tabindex="0" role="button"
         onkeydown="if(event.key === 'Enter' || event.key === ' ') selecionarPerfil('passageiro')">
      <h3>ğŸ§ Passageiro</h3>
      <p>Acompanhe a rota e a localizaÃ§Ã£o do Ã´nibus</p>
    </div>

    <div class="card" onclick="selecionarPerfil('admin')" tabindex="0" role="button"
         onkeydown="if(event.key === 'Enter' || event.key === ' ') selecionarPerfil('admin')">
      <h3>ğŸ› ï¸ Administrador</h3>
      <p>GestÃ£o, avisos, monitoramento e controle</p>
    </div>

    <button class="btn secondary" onclick="mostrarTela('welcome')" style="margin-top:20px">
      â† Voltar
    </button>
  </section>

  <!-- TELA: LOGIN MOTORISTA -->
  <section id="tela-motorista-login" class="tela hidden">
    <h2>ğŸš› Login do Motorista</h2>
    <p>Informe sua matrÃ­cula para continuar.</p>

    <div class="card">
      <input
        id="matriculaMotorista"
        type="text"
        placeholder="Digite sua matrÃ­cula"
        class="input"
        aria-label="MatrÃ­cula do motorista"
        maxlength="10"
        autocomplete="off"
      />
      <div class="input-hint">Exemplo: AC1234</div>
      <button class="btn" onclick="confirmarMatriculaMotorista()" id="loginBtn">
        Entrar
      </button>
    </div>

    <button class="btn secondary" onclick="mostrarTela('telaEscolhaPerfil')">
      â† Voltar
    </button>
  </section>

  <!-- TELA: MOTORISTA AUTENTICADO -->
  <section id="tela-motorista" class="tela hidden">
    <div class="user-header">
      <h2>OlÃ¡, <span id="motoristaNome"></span>!</h2>
      <small>MatrÃ­cula: <span id="motoristaMatricula"></span></small>
    </div>
    
    <div class="card">
      <p id="rotaStatus">Nenhuma rota ativa</p>
      <button class="btn secondary" onclick="pararRota()" id="pararRotaBtn" style="display:none">
        â¹ï¸ Parar Rota
      </button>
    </div>

    <div class="card" onclick="mostrarTela('tela-rotas')" tabindex="0" role="button"
         onkeydown="if(event.key === 'Enter' || event.key === ' ') mostrarTela('tela-rotas')">
      <h3>ğŸ—ºï¸ Selecionar Rota</h3>
      <p>Escolha a rota que irÃ¡ conduzir</p>
    </div>

    <div class="card" onclick="openModal('avisosModal')" tabindex="0" role="button"
         onkeydown="if(event.key === 'Enter' || event.key === ' ') openModal('avisosModal')">
      <h3>ğŸ“¢ Avisos & Comunicados</h3>
      <p>InformaÃ§Ãµes importantes</p>
    </div>

    <div class="card">
      <a class="btn" href="https://forms.gle/UDniKxPqcMKGUhFQA" target="_blank" rel="noopener noreferrer">
        ğŸ“‹ Controle de VeÃ­culo
      </a>
      <small class="note">Entrada e saÃ­da (obrigatÃ³rio)</small>
    </div>

    <button class="btn secondary" onclick="logout()" style="margin-top:20px">
      ğŸšª Sair
    </button>
  </section>

  <!-- TELA: ROTAS -->
  <section id="tela-rotas" class="tela hidden">
    <h2>Rotas DisponÃ­veis</h2>
    <p>Selecione abaixo a rota que vocÃª irÃ¡ conduzir:</p>

    <div class="search-filter">
      <input 
        type="text" 
        id="routeSearch" 
        class="input" 
        placeholder="Buscar rota..." 
        oninput="searchRoutes()"
        aria-label="Buscar rotas"
      />
      <div class="filter-buttons">
        <button class="filter-btn active" onclick="filterRoutes('all')">Todas</button>
        <button class="filter-btn" onclick="filterRoutes('adm')">ADM</button>
        <button class="filter-btn" onclick="filterRoutes('operacional')">Operacional</button>
        <button class="filter-btn" onclick="filterRoutes('retorno')">Retorno</button>
      </div>
    </div>

    <div class="routes" id="routesContainer">
      <!-- Rotas serÃ£o carregadas dinamicamente -->
    </div>

    <button class="btn secondary" onclick="mostrarTela('tela-motorista')" style="margin-top:20px">
      â† Voltar
    </button>
  </section>

  <!-- TELA: PASSAGEIRO -->
  <section id="tela-passageiro" class="tela hidden">
    <h2>ğŸ§ Passageiro</h2>
    <p>Acompanhe sua rota em tempo real.</p>
    
    <div class="card">
      <h3>Rotas Ativas</h3>
      <div id="rotasAtivasList">
        <p>Carregando rotas ativas...</p>
      </div>
    </div>

    <button class="btn secondary" onclick="mostrarTela('telaEscolhaPerfil')">
      â† Voltar
    </button>
  </section>

  <!-- TELA: ADMIN -->
  <section id="tela-admin-login" class="tela hidden">
    <h2>ğŸ› ï¸ Administrador</h2>
    <p>Acesso restrito Ã  equipe de gestÃ£o.</p>

    <div class="card">
      <input type="email" id="adminEmail" placeholder="E-mail" class="input" />
      <input type="password" id="adminSenha" placeholder="Senha" class="input" />
      <button class="btn" onclick="loginAdmin()">Entrar</button>
    </div>

    <button class="btn secondary" onclick="mostrarTela('telaEscolhaPerfil')">
      â† Voltar
    </button>
  </section>

  <!-- TELA: ADMIN DASHBOARD -->
  <section id="tela-admin-dashboard" class="tela hidden">
    <h2>Painel de Controle</h2>
    
    <div class="card">
      <h3>ğŸš› Rotas em Andamento</h3>
      <div id="adminRotasList">
        <p>Monitorando rotas...</p>
      </div>
    </div>

    <div class="card">
      <h3>ğŸ“Š EstatÃ­sticas</h3>
      <p>Total de motoristas: <span id="totalMotoristas">0</span></p>
      <p>Rotas ativas: <span id="rotasAtivasCount">0</span></p>
    </div>

    <button class="btn secondary" onclick="logout()">
      ğŸšª Sair
    </button>
  </section>
</main>
  
<!-- MODAIS -->
<div id="avisosModalBack" class="modal-back" aria-hidden="true" style="display:none">
  <div class="modal">
    <button class="close" onclick="closeModal('avisosModalBack')" aria-label="Fechar">âœ•</button>
    <h3>Avisos Importantes</h3>
    <ul>
      <li>Preencher o Controle de VeÃ­culo 2Ã— ao dia (entrada e saÃ­da).</li>
      <li>Mantenha comunicaÃ§Ã£o constante com a gestÃ£o em caso de desvios.</li>
      <li>Relatar imediatamente qualquer avaria ou irregularidade do veÃ­culo.</li>
      <li>NÃ£o alterar rota sem autorizaÃ§Ã£o do setor de operaÃ§Ãµes.</li>
      <li>Para rotas de retorno Overland, verificar sempre as condiÃ§Ãµes da via antes de iniciar.</li>
    </ul>
    <div style="margin-top:12px">
      <button class="btn" onclick="closeModal('avisosModalBack')">Fechar</button>
    </div>
  </div>
</div>

<div id="ajudaModalBack" class="modal-back" aria-hidden="true" style="display:none">
  <div class="modal">
    <button class="close" onclick="closeModal('ajudaModalBack')" aria-label="Fechar">âœ•</button>
    <h3>Ajuda & ExplicaÃ§Ã£o dos BotÃµes</h3>
    <p><strong>Preencher Controle de VeÃ­culo:</strong> Abre o formulÃ¡rio obrigatÃ³rio (Google Forms). Preencher na entrada e na saÃ­da.</p>
    <p><strong>Selecionar Rota:</strong> Mostra as rotas publicadas pela gestÃ£o; ao clicar em "Abrir no Maps" o Google Maps serÃ¡ aberto com a rota pronta.</p>
    <p><strong>Rotas Operacionais (ğŸš›):</strong> Rotas principais de transporte.</p>
    <p><strong>Rotas Administrativas (ğŸ¢):</strong> Rotas para deslocamentos administrativos.</p>
    <p><strong>Rotas de Retorno (ğŸ”„):</strong> Rotas especÃ­ficas para retorno Overland.</p>
    <p><strong>Avisos:</strong> Comunicados importantes e mudanÃ§as operacionais â€” leia sempre antes de iniciar.</p>
    <p><strong>Instalar / Adicionar Ã  Tela Inicial:</strong> Permite transformar o site em um app no celular do motorista.</p>
    <div style="margin-top:12px">
      <button class="btn" onclick="closeModal('ajudaModalBack')">Fechar</button>
    </div>
  </div>
</div>

<!-- LOADING OVERLAY -->
<div id="loadingOverlay" class="loading-overlay" style="display:none">
  <div class="loading-spinner"></div>
  <p id="loadingText">Carregando...</p>
</div>

<!-- OFFLINE BANNER -->
<div id="offlineBanner" class="offline-banner" style="display:none">
  âš ï¸ VocÃª estÃ¡ offline. Algumas funcionalidades podem nÃ£o estar disponÃ­veis.
</div>

<script>
  // FunÃ§Ãµes globais essenciais
  window.openModal = openModal;
  window.closeModal = closeModal;
  window.mostrarTela = mostrarTela;
  window.entrarNoPortal = entrarNoPortal;
  window.selecionarPerfil = selecionarPerfil;
  window.confirmarMatriculaMotorista = confirmarMatriculaMotorista;
  window.iniciarRota = iniciarRota;
  window.pararRota = pararRota;
  window.logout = logout;
  window.loginAdmin = loginAdmin;
  window.searchRoutes = searchRoutes;
  window.filterRoutes = filterRoutes;
</body>
</html>
